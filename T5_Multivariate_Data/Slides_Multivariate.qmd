---
title: Multivariable Data  
subtitle: "IN2039: Data Visualization for Decision Making"
author: 
  - name: Alan R. Vazquez
    affiliations:
      - name: Department of Industrial Engineering
format: 
  revealjs:
    chalkboard: true
    multiplex: true
    footer: "Tecnológico de Monterrey"
    logo: IN2039_logo.png
    css: style.css
    slide-number: True
execute:
  echo: true  
editor: visual
---

## Agenda

1.  Data with more than one variable

2.  Two numerical variables

3.  One numerical and one categorical variable

4.  Two categorical variables

5.  Three or more variables

## Load Libraries

Let's load the `readxl`, `ggplot2`, `ggformula`, and `dplyr`libraries in Google Colab and R before starting.

```{r}
#| echo: true
#| output: false

# Nos se te olvide instalar la librería "ggformula" en Google Colab.
# install.packages("ggformula")
library(readxl)
library(ggplot2)
library(ggformula)
library(dplyr)
```

## Multivariate Data

Multivariate data consists of datasets that contain observations of two or more variables.

::: incremental
-   Variables can be numerical or categorical.

-   Variables may or may not depend on each other.
:::

. . .

In fact, the **goal** is to determine whether there is a relationship between the variables and the type of relationship.

## Example 1

Consider data from 392 cars, including miles per gallon, number of cylinders, horsepower, weight, acceleration, year, origin, among other variables.

The data is stored in the file "auto_dataset.xlsx".

```{r}
#| echo: true
auto_data = read_excel("auto_dataset.xlsx") 
auto_data %>% head()
```

## Principle 1: Formulate the Question

In the context of multiple-variable data, typical questions to study include:

::: incremental
-   ¿How are variable $X$ and variable $Y$ related?

-   Is the distribution of variable $X$ the same across all subgroups defined by variable $Z$?

-   Are there any unusual observations in the combination of values for variables $X$ and $Y$?

-   Are there any unusual observations in $X$ for a subgroup of variable $Z$?
:::

## Principle 2: Turn Data into Information

There are various types of graphs that help us explore relationships between two or more variables.

::: center
| Type        | Graph Type                                                     |
|:-----------------|:-----------------------------------------------------|
| Numerical   | Scatter plot, line graph                    |
| Categorical | Side-by-side bar chart, stacked bar chart   |
| Mixed       | GSide-by-side box plot, bubble chart |
:::

::: notes
For two features, the combination of types (both quantitative, both qualitative, or a mix) matters.
:::

# Two Numerical Variables

## Independent and Dependent Variables

When investigating the relationship between two variables (numerical or categorical), we use specific terminology.

. . .

One variable is called the *dependent* or *response variable*, denoted by the letter $Y$.

. . .

The other variable is called the *independent* or *predictor variable*, denoted by the letter $X$.

. . .

> Our goal is to determine whether changes in variable $X$ are associated with changes in variable $Y$, and the nature of this association.

## Scatter Plot

The most common graph for examining the relationship between two numerical variables is the  [***scatter plot***]{style="color:#174062;"}.

. . .

Variables $X$ and $Y$ are placed on the horizontal and vertical axes, respectively. Each point on the graph represents a pair of $X$ and $Y$ values.

. . .

> The goal is to explore linear or non-linear relationships between variables.

## 

To create scatter plots, we use the function `gf_point(Y ~ X, data = data_set)`.

. . .

For example, let's create a plot to explore the relationship between a car's weight (`weight`) and its fuel efficiency in miles per gallon (`mpg`)

```{r}
#| fig-pos: center
#| echo: true
#| output: false


gf_point(mpg ~ weight, data = auto_data)
```

## 

```{r}
#| fig-pos: center
#| echo: true
#| output: true


gf_point(mpg ~ weight, data = auto_data)
```

## Principle 3: Apply Graphic Design

Following Principle 3, we can modify the default function values to define different colors or shapes for the points in the graph.

Specifically, you can change the color, shape, and size of points using the arguments  `color`, `shape` and `size`, respectively.

</br>

`gf_point(Y ~ X, data = data_set, color, shape, size)`

## 

```{r}
#| fig-pos: center
#| echo: true

gf_point(mpg ~ weight, data = auto_data, color = "blue", 
         shape = 4, size = 5)
```

## Possible Point Shapes

To change the symbols used for points in a scatter plot, set the `shape` parameter to a number or character from the chart below.

![](images/FIG-SCATTER-SHAPES-CHART-1.png){fig-align="center" width="530" height="344"}

## 

Continuing with Principle 3, you can use previously seen functions to further improve the chart's appearance.

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: true

mi_diagrama = gf_point(mpg ~ weight, data = auto_data, color = "darkblue", size = 2, linetype = 1) + labs(title = "Relación de peso y millas por galón en autos", x = "Peso (lb)", y = "Millas por galón")
mi_diagrama = mi_diagrama + theme(axis.text=element_text(size=20), axis.title=element_text(size=20),
                                   plot.title=element_text(size=25)) 
mi_diagrama 
```

## Include Zero

In the previous chart, the minimum vertical axis value is around 10. To adjust the minimum value to 0, we use the additional command below.

```{r}
#| fig-pos: center
#| echo: true

mi_diagrama = mi_diagrama + scale_y_continuous(limits = c(0, 50))
mi_diagrama
```

## 

If necessary, we can also adjust the horizontal axis to show 0 as well.

```{r}
#| fig-pos: center
#| echo: true

mi_diagrama + scale_x_continuous(limits = c(0, 5500))
```

## Individual Graphs

Individual variable graphs (such as histograms) do not allow us to study the relationship between two variables. They only provide information on the *distribution* of each variable.

::::: columns
::: {.column width="50%"}
```{r}
#| fig-pos: center
#| echo: true
#| code-fold: true

histogram_mpg = gf_histogram( ~ mpg, data = auto_data, fill = "darkblue", color = "black") 
histogram_mpg = histogram_mpg + labs(title = "Distribución de milas por galón", x = "Millas por galón", y = "Frecuencia")
histogram_mpg = histogram_mpg + theme(axis.text=element_text(size=20), axis.title=element_text(size=20),
                                       plot.title=element_text(size=25))
histogram_mpg
```
:::

::: {.column width="50%"}
```{r}
#| fig-pos: center
#| echo: true
#| code-fold: true

histogram_weight = gf_histogram( ~ weight, data = auto_data, fill = "darkblue", color = "black") 
histogram_weight = histogram_weight + labs(title = "Distribución de peso", x = "Peso (lb)", y = "Frecuencia")
histogram_weight = histogram_weight + theme(axis.text=element_text(size=20), axis.title=element_text(size=20), plot.title=element_text(size=25))
histogram_weight
```
:::
:::::

## GLine Graph

A line graph is a visual representation of data where data points are connected by a line. Axes:

-   $X$ (horizontal): Represents time or the independent variable.
-   $Y$ (vertical): Represents the dependent variable.

Each point represents a value at a given moment.

. . .

> The objective is to explore trends over time or the evolution of a continuous variable.

## Example 2

Consider the data in the file "spotify.xlsx". This dataset contains the global daily streams of the top five most popular songs on the music streaming service Spotify in 2017.

```{r}
#| echo: true

spotify_data = read_excel("spotify.xlsx") 
spotify_data %>% head(3)
```

## 

We will focus on the song *Despacito* by Luis Fonsi. To construct scatter plots, we use the function`gf_line(Y ~ X, data = data_set)`.

```{r}
#| echo: true

gf_line(Despacito ~ Date, data = spotify_data)
```

## Applying Principle 3

We can change various aspects of the graph using additional arguments `linetype`, `size`, and `color`.

</br>

`gf_line(Y ~ X, linetype, size, color, data = data_set)`.

## 

```{r}
#| echo: true
#| code-fold: true


mi_linea = gf_line(Despacito ~ Date, data = spotify_data, color = "darkblue", size = 1.3) + labs(title = "Popularidad de la canción despacito de Luis Fonsi", x = "Fecha", y = "Número de reproducciones en Spotify")
mi_linea = mi_linea + theme(axis.text=element_text(size=20), axis.title=element_text(size=18),
                                plot.title=element_text(size=25)) 
mi_linea
```

## Line Types

To change the line type, set the `linetype` parameter to a number or a word shown below.

![](images/clipboard-2759814636.png){fig-align="center"}

# A Categorical and a Numerical Variable

## !Divide the Data into Groups!

To examine the relationship between a numerical and a categorical variable, we use the categorical variable to divide the data into groups. This way, we **compare the distribution** of the numerical variable among these groups.

. . .

In this context:

-   $X$ is the categorical variable.
-   $Y$ is the numerical variable.

. . .

The [side-by-side boxplot]{style="color:#D70040;"} is the most effective way to study the relationship between a categorical and a numerical variable.

## Boxplot by Groups

The side-by-side boxplot compares the distribution of a variable across different groups.

</br>

The plot is obtained using the function:

`gf_boxplot(Y ~ X, data = dataset)`.

## 

For example, if we want to compare the distributions of miles per gallon of cars built in America, Europe, or Japan, we use the following command:

```{r}
#| fig-pos: center
#| echo: true

gf_boxplot(mpg ~ origin, data = auto_data) 
```

## Applying Principle 3

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: true

bp_mpg_by_origin = gf_boxplot(mpg ~ origin, data = auto_data, fill = "lightblue", color = "black") 
bp_mpg_by_origin = bp_mpg_by_origin + labs(y = "Millas por galón", x = "Origen")
bp_mpg_by_origin = bp_mpg_by_origin + theme(axis.text=element_text(size=20), axis.title=element_text(size=20))
bp_mpg_by_origin
```

## 

We can also change the format of outlier points using the arguments `outlier.color`, `outlier.shape`, and `outlier.size`.

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: true

bp_mpg_by_origin = gf_boxplot(mpg ~ origin, data = auto_data, fill = "lightblue", 
                               color = "black", outlier.color = "red",
                               outlier.shape = 4, outlier.size = 4) 
bp_mpg_by_origin = bp_mpg_by_origin + labs(y = "Millas por galón", x = "Origen")
bp_mpg_by_origin = bp_mpg_by_origin + theme(axis.text=element_text(size=20), axis.title=element_text(size=20))
bp_mpg_by_origin
```

## Plotting Statistical Summaries by Groups

Alternatively, we can summarize the values of the numerical variable $Y$ for each category of the variable $X$ using the median or the mean.

For example, let's plot the average miles per gallon of cars produced in America, Europe, and Japan. First, we calculate the average for each category using `group_by()` and `summarise()`.

```{r}
#| echo: true
#| output: true

resumen_autos = auto_data %>% 
  group_by(origin) %>% 
  summarise("Promedio.mpg" = mean(mpg))
```

## 

The data to be plotted are:

```{r}
#| echo: true
#| output: true

resumen_autos
```

Two common visualization types for plotting a numerical and a discrete variable when there is only one value per category are:

-   Cleveland dot plot
-   Bar chart

## Cleveland Dot Plot

The Cleveland dot plot encodes quantitative data across different categories. It is an alternative to a bar chart. It is obtained using the function `gf_point()`.

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: false

gf_point(origin ~ Promedio.mpg, data = resumen_autos) 

```

## Improving the Plot

We apply Principle 3 to improve the plot.

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: true

gf_point(origin ~ Promedio.mpg, size = 10, color = "pink", data = resumen_autos) +
  labs(y = "Origen", x = "Promedio de Millas por Galón", 
       title = "Comparación de autos de diferences regiones") + 
  scale_x_continuous(limits = c(0, 35)) + 
  theme_bw() + 
  theme(axis.text=element_text(size=20), axis.title=element_text(size=20),
        plot.title=element_text(size=20))

```

## Bar Chart

To create a bar chart where the bar length equals a specific value, we use the function `gf_col()` dfrom the **ggformula** library.

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: false

gf_col(origin ~ Promedio.mpg, data = resumen_autos) 
```

## 

We can use similar commands as the Cleveland dot plot to improve the bar chart.

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: true

gf_col(origin ~ Promedio.mpg, fill = "pink", data = resumen_autos) +
  labs(y = "Origen", x = "Promedio de Millas por Galón", 
       title = "Comparación de autos de diferences regiones") + 
  theme_bw() + 
  theme(axis.text=element_text(size=20), axis.title=element_text(size=20),
        plot.title=element_text(size=20))

```

# Two Categorical Variables

## !Divide the Data into Groups!

With two categorical variables, we compare the distribution of one variable across subgroups defined by the other variable.

In fact, we keep one variable constant and plot the distribution of the other.

. . .

To do this, the most popular charts are extensions of bar graphs:

-   Stacked bar charts
-   Side-by-side bar charts

## Example 3

As an example, let's consider the data in the file "penguins.xlsx".

```{r}
#| echo: true

penguins_data = read_excel("penguins.xlsx")
penguins_data %>% head()
```

## 

The data has two categorical variables:

-   The species of penguins (`species`).
-   The island they come from (`island`).

Make sure they are specified as `factor` in R!

```{r}
#| echo: true

penguins_data = penguins_data %>% 
  mutate_at(c("species", "island", "sex"), as.factor)
```

## Stacked Bar Chart

The side-by-side bar chart is generated using the `gf_bar()`, function, assigning the $X$ variable to the `fill`argument.

The variable name must be preceded by a tilde `~X`.

</br>

. . .

For example, to study the distribution of penguin species across the three different islands, we use the following:

```{r}
#| fig-pos: center
#| echo: true
#| output: false

gf_bar( ~ species, data = penguins_data, fill = ~island)
```

## 

The chart shows the frequency of each species, separated by island name.

```{r}
#| fig-pos: center
#| echo: true

gf_bar( ~ species, fill = ~island, data = penguins_data)
```

## Side-by-Side Bar Chart

An alternative to the previous chart is to place the bars side by side for the categories of the $X$ variable.

In this case, we use the same commands with an extra argument: `position = position_dodge()`.

```{r}
#| fig-pos: center
#| echo: true
#| output: false

gf_bar( ~ species, fill = ~island, 
        data = penguins_data, position = position_dodge())
```

## 

```{r}
#| fig-pos: center
#| echo: true

gf_bar( ~ species, data = penguins_data, 
        fill = ~island, position = position_dodge())
```

## Stacked or Side-by-Side?

The main difference between stacked and side-by-side bar charts is that the side-by-side chart shows values in separate bars within a category.

Advantages of **stacked** bars:

-   Easier to understand what proportions of a whole are divided among segments.

-   Visually adds up each proportion.

## 

Advantages of **side-by-side** bars:

-   Easier to compare the heights of each individual entity.

-   Better for comparing between groups.

## Statistical Summaries

For categorical variables, the most common statistical summaries are frequency and relative frequency.

With **dplyr**, we calculate frequency using the `count()`, function, which counts the unique values of one or more variables.

```{r}
#| echo: true
#| output: true

penguins_data %>% count(island, species) %>% group_by(island)
```

## 

To calculate relative frequency, we use `mutate()` along with the `prop.table()`, function, which calculates the proportions of a column.

```{r}
#| fig-pos: center
#| echo: true
#| output: true

tabla.resumen = penguins_data %>% 
  count(island, species) %>% 
  group_by(island) 
tabla.resumen %>% mutate("Proporción" = prop.table(n))
```

# More than One Variable

## Charts for Three Variables

-   When examining a distribution or relationship, we often want to compare it across data subgroups.

-   This process of conditioning on additional variables leads to visualizations involving three or more variables.

-   Here we explain how to create charts to visualize multiple variables.

## Scatter Plot by Color

For two numerical variables and one categorical variable.

```{r}
#| fig-pos: center
#| echo: true

gf_point(mpg ~ weight, color = ~origin, data = auto_data) 
```

## Faceted or Lattice Plot

A faceted plot visualizes the relationship or distribution of one or two variables for each subgroup defined by a third variable $Z$.

. . .

**Idea:** Create a chart for each subgroup of $Z$.

. . .

To create the plot, use the `gf_facet_grid` function with the following syntax:

```{r}
#| fig-pos: center
#| echo: true
#| code-fold: false
#| output: false

gf_point(mpg ~ weight, data = auto_data) %>% 
  gf_facet_grid(origin ~ .) 
```

## 

The function produces a grid with 1 column and 3 rows of charts. Each row accommodates one category of  `origin`.

```{r}
#| fig-pos: center
#| echo: true

gf_point(mpg ~ weight, data = auto_data) %>% gf_facet_grid(origin ~ .) 
```

## 

If we change the order of the `origin` variable in the `gf_facet_grid`, function, we get a grid with three columns and one row of charts.

```{r}
#| fig-pos: center
#| echo: true

gf_point(mpg ~ weight, data = auto_data) %>% gf_facet_grid( ~ origin)
```

## Multiple Line Charts

We can use the functions `gf_line()` and `gf_facet_grid()` to visualize the evolution of play counts for the 5 songs in the file "spotify.xlsx" over time.

</br>

However, we need to manipulate the data to obtain the format required by these functions.

## The Required Format

For a multiple line chart, we need to merge the columns `Shape of You`, `Despacito`, `Something Just Like This`, `HUMBLE` and `Unforgettable` into two columns.

One column will contain the number of plays, and the other will contain the song title.

Both columns will be ordered by the variable `Date`.

## A New Library: tidyr

::::: columns
::: {.column width="50%"}
![](images/tidyverse.jpeg){fig-align="center" width="491" height="374"}
:::

::: {.column width="50%"}
-   **tidyr** allows reshaping and regrouping a dataset.

-   It is part of a collection of data science packages called *tidyverse*.

-   <https://tidyr.tidyverse.org/>
:::
:::::

Load it in Google Colab with the following code:

```{r}
#| echo: true
#| output: false

library(tidyr)
```

## 

To format the data, we use the `pivot_longer()` function from the **tidyr** library.

```{r}
#| fig-pos: center
#| echo: true

data_lines = spotify_data %>% 
  pivot_longer(c("Shape of You", "Despacito", "Something Just Like This", 
                 "HUMBLE.", "Unforgettable"), 
               names_to = "Cancion", 
               values_to = "Reproducciones")
data_lines %>% head()
```

## 

Now, we apply similar functions to the`data_lines`object.

```{r}
#| fig-pos: center
#| echo: true

gf_line(Reproducciones ~ Date, data = data_lines) %>%
  gf_facet_grid( ~ Cancion)
```

## 

Or we can plot all lines on a single chart.

```{r}
#| fig-pos: center
#| echo: true

gf_line(Reproducciones ~ Date, color = ~Cancion, data = data_lines)
```

## Area Chart

An area chart is a specialized form of a line chart, where points are connected with a continuous line, and the region beneath the line is filled with a solid color. It is generated using the  `gf_area()`function from **ggformula**.

```{r}
#| fig-pos: center
#| echo: true

gf_area(Reproducciones ~ Date, color = ~Cancion, 
        fill = ~Cancion, data = data_lines)
```

## Applying Principle 3

In addition to the previously seen functions, we can make the areas transparent using the `alpha`parameter.

```{r}
#| fig-pos: center
#| code-fold: true
#| echo: true

gf_area(Reproducciones ~ Date, color = ~Cancion, 
        fill = ~Cancion, data = data_lines, alpha = 0.5) + theme_bw()
```

## Charts for Four Variables

A common chart for four variables is the scatter plot, where the color and size of the symbols depend on two [**categorical**]{style="color:#8B8000;"} variables.

</br>

```{r}
#| fig-pos: center
#| echo: true
#| output: false

gf_point(bill_length_mm ~ bill_depth_mm, size = ~island, 
color = ~species, data = penguins_data)
```

## 

```{r}
#| fig-pos: center
#| echo: true

gf_point(bill_length_mm ~ bill_depth_mm, size = ~island, 
color = ~species, data = penguins_data)
```

# More Charts

<https://www.mosaic-web.org/ggformula/articles/pkgdown/ggformula-long.html>

# [Return to Main Page](https://alanrvazquez.github.io/TEC-IN2039-Website/TEC-IN2039-Website.html)
